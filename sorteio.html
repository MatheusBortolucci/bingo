<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteio e Valida√ß√£o - Bingo da Mari</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #fce4ec, #f8bbd9);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e91e63, #f06292);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ff4081, #e91e63);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #ff9800, #ffb74d);
        }

        .item-sorteado {
            background: linear-gradient(135deg, #9c27b0, #ba68c8);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.3);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lista-itens {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .item.sorteado {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
            border-color: #4caf50;
            transform: scale(1.02);
        }

        .scanner-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .scanner-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        #scanner-video {
            width: 100%;
            max-width: 400px;
            border: 3px solid #e91e63;
            border-radius: 15px;
            display: none;
        }

        .resultado-validacao {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .resultado-validacao.vencedor {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            color: white;
        }

        .resultado-validacao.perdedor {
            background: linear-gradient(135deg, #f44336, #ef5350);
            color: white;
        }

        .cartela-info {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            display: none;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .lista-itens {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≤ Sorteio e Valida√ß√£o</h1>
            <p>Ch√° de Panela da Mari - Sistema de Bingo</p>
        </div>

        <div class="content">
            <!-- Estat√≠sticas -->
            <div class="stats">
                <div class="stat-card">
                    <span class="stat-number" id="totalItens">0</span>
                    <span class="stat-label">Total de Itens</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="itensSorteados">0</span>
                    <span class="stat-label">Itens Sorteados</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="itensRestantes">0</span>
                    <span class="stat-label">Itens Restantes</span>
                </div>
            </div>

            <!-- Controles -->
            <div class="controls">
                <button id="sortearItem" class="btn">üé≤ Sortear Item</button>
                <button id="reiniciarSorteio" class="btn secondary">üîÑ Reiniciar Sorteio</button>
            </div>

            <!-- Item sorteado -->
            <div class="item-sorteado" id="itemSorteado">
                Clique em "Sortear Item" para come√ßar!
            </div>

            <!-- Lista de itens -->
            <h3>üìã Lista de Itens</h3>
            <div class="lista-itens" id="listaItens">
                <!-- Itens ser√£o carregados aqui -->
            </div>

            <!-- Scanner de QR Code -->
            <div class="scanner-section">
                <h3>üì± Valida√ß√£o de Cartela</h3>
                <div class="scanner-controls">
                    <button id="iniciarScanner" class="btn">üì∑ Iniciar Scanner</button>
                    <button id="pararScanner" class="btn secondary" style="display: none;">‚èπÔ∏è Parar Scanner</button>
                    <button id="testarValidacao" class="btn" style="background: linear-gradient(135deg, #9c27b0, #ba68c8);">üß™ Teste de Valida√ß√£o</button>
                    <button id="debugDatabase" class="btn" style="background: linear-gradient(135deg, #ff5722, #ff7043);">üîç Debug Database</button>
                </div>
                
                <video id="scanner-video" autoplay playsinline></video>
                
                <div class="resultado-validacao" id="resultadoValidacao"></div>
                <div class="cartela-info" id="cartelaInfo"></div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Carregando sistema de sorteio...');
        
        // Array de itens do bingo (id√™ntico ao script-novo.js)
        const itensBingo = [
            // Talheres B√°sicos
            "Garfo", "Faca", "Colher", "Colher de ch√°", "Faca de p√£o", "Garfo de sobremesa",
            
            // Panelas e Frigideiras
            "Panela de press√£o", "Panela", "Frigideira", "Ca√ßarola", "Leiteira", "Chaleira",
            
            // Utens√≠lios B√°sicos de Cozinha
            "Concha", "Escumadeira", "Esp√°tula", "Colher de pau", "Batedor de ovos", "Pegador",
            "Abridor de latas", "Saca-rolhas", "Descascador", "Ralador", "Peneira", "Coador",
            "T√°bua de corte", "Rolo de massa", "Funil",
            
            // Assadeiras e Formas
            "Assadeira", "Forma de bolo", "Forma de pizza", "Forma de p√£o", "Refrat√°rio",
            
            // Eletrodom√©sticos Comuns
            "Liquidificador", "Batedeira", "Torradeira", "Cafeteira", "Micro-ondas", "Mixer",
            
            // Recipientes e Potes
            "Tigela", "Jarra", "Potes", "Tupperware", "Garrafa t√©rmica",
            
            // Itens para Servir
            "Pratos", "X√≠caras", "Copos", "Canecas", "Travessa", "A√ßucareiro", "Bule",
            
            // Utens√≠lios de Medi√ß√£o
            "Balan√ßa", "X√≠caras medidoras", "Timer",
            
            // Itens Diversos
            "Avental", "Luvas de forno", "Panos de prato", "Escorredor de lou√ßas", "Porta-talheres",
            "Descanso de panela", "Guardanapos", "Papel toalha", "Papel alum√≠nio", "Filme pl√°stico"
        ];

        // Estado do jogo
        let itensSorteados = [];
        let itensDisponiveis = [...itensBingo];

        // Estado do scanner
        let stream = null;
        let scanning = false;
        let scannerInterval = null;

        // Aguardar carregamento da p√°gina
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializarSistema);
        } else {
            inicializarSistema();
        }

        function inicializarSistema() {
            console.log('üé≤ Inicializando sistema de sorteio...');
            
            // Verificar se elementos existem
            const sortearBtn = document.getElementById('sortearItem');
            const reiniciarBtn = document.getElementById('reiniciarSorteio');
            
            if (!sortearBtn || !reiniciarBtn) {
                console.error('‚ùå Elementos n√£o encontrados!');
                return;
            }
            
            console.log('‚úÖ Elementos encontrados, configurando...');
            
            inicializar();
            configurarEventListeners();
        }

        function inicializar() {
            console.log('üìä Carregando dados iniciais...');
            carregarItens();
            atualizarEstatisticas();
            carregarEstadoSorteio();
            console.log('‚úÖ Sistema inicializado com sucesso!');
        }

        function configurarEventListeners() {
            console.log('üîó Configurando event listeners...');
            
            const sortearBtn = document.getElementById('sortearItem');
            const reiniciarBtn = document.getElementById('reiniciarSorteio');
            const iniciarScannerBtn = document.getElementById('iniciarScanner');
            const pararScannerBtn = document.getElementById('pararScanner');
            const testarBtn = document.getElementById('testarValidacao');
            const debugBtn = document.getElementById('debugDatabase');
            
            if (sortearBtn) {
                sortearBtn.addEventListener('click', function() {
                    console.log('üé≤ Bot√£o sortear clicado!');
                    sortearItem();
                });
                console.log('‚úÖ Event listener do sortear configurado');
            }
            
            if (reiniciarBtn) {
                reiniciarBtn.addEventListener('click', function() {
                    console.log('üîÑ Bot√£o reiniciar clicado!');
                    reiniciarSorteio();
                });
                console.log('‚úÖ Event listener do reiniciar configurado');
            }
            
            if (iniciarScannerBtn) {
                iniciarScannerBtn.addEventListener('click', function() {
                    console.log('üì∑ Bot√£o iniciar scanner clicado!');
                    iniciarScanner();
                });
                console.log('‚úÖ Event listener do scanner configurado');
            }
            
            if (pararScannerBtn) {
                pararScannerBtn.addEventListener('click', function() {
                    console.log('‚èπÔ∏è Bot√£o parar scanner clicado!');
                    pararScanner();
                });
                console.log('‚úÖ Event listener do parar scanner configurado');
            }
            
            if (testarBtn) {
                testarBtn.addEventListener('click', function() {
                    console.log('üß™ Bot√£o teste clicado!');
                    testarValidacao();
                });
                console.log('‚úÖ Event listener do teste configurado');
            }
            
            if (debugBtn) {
                debugBtn.addEventListener('click', function() {
                    console.log('üîç Bot√£o debug clicado!');
                    debugDatabase();
                });
                console.log('‚úÖ Event listener do debug configurado');
            }
            
            console.log('üéØ Todos os event listeners configurados!');
        }

        function carregarItens() {
            console.log('üìã Carregando lista de itens...');
            const container = document.getElementById('listaItens');
            
            if (!container) {
                console.error('‚ùå Container da lista n√£o encontrado!');
                return;
            }
            
            container.innerHTML = '';

            itensBingo.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'item';
                div.textContent = item;
                
                if (itensSorteados.includes(item)) {
                    div.classList.add('sorteado');
                }
                
                container.appendChild(div);
            });
            
            console.log(`‚úÖ ${itensBingo.length} itens carregados na lista`);
        }

        function atualizarEstatisticas() {
            console.log('üìà Atualizando estat√≠sticas...');
            
            const totalElement = document.getElementById('totalItens');
            const sorteadosElement = document.getElementById('itensSorteados');
            const restantesElement = document.getElementById('itensRestantes');
            
            if (totalElement) totalElement.textContent = itensBingo.length;
            if (sorteadosElement) sorteadosElement.textContent = itensSorteados.length;
            if (restantesElement) restantesElement.textContent = itensDisponiveis.length;
            
            const btnSortear = document.getElementById('sortearItem');
            if (btnSortear) {
                btnSortear.disabled = itensDisponiveis.length === 0;
                
                if (itensDisponiveis.length === 0) {
                    btnSortear.textContent = 'üéâ Sorteio Completo!';
                } else {
                    btnSortear.textContent = 'üé≤ Sortear Item';
                }
            }
            
            console.log(`üìä Stats: ${itensSorteados.length}/${itensBingo.length} sorteados`);
        }

        function sortearItem() {
            console.log('üé≤ Executando sorteio...');
            
            if (itensDisponiveis.length === 0) {
                alert('üéâ Todos os itens j√° foram sorteados!');
                console.log('‚ö†Ô∏è Tentativa de sorteio com lista vazia');
                return;
            }

            const indice = Math.floor(Math.random() * itensDisponiveis.length);
            const item = itensDisponiveis[indice];

            itensDisponiveis.splice(indice, 1);
            itensSorteados.push(item);

            const itemElement = document.getElementById('itemSorteado');
            if (itemElement) {
                itemElement.textContent = item;
            }
            
            carregarItens();
            atualizarEstatisticas();
            salvarEstadoSorteio();

            console.log(`üéØ Item sorteado: "${item}"`);
            
            // Feedback visual
            if ('vibrate' in navigator) {
                navigator.vibrate(100);
            }
        }

        function reiniciarSorteio() {
            console.log('üîÑ Tentando reiniciar sorteio...');
            
            if (confirm('üîÑ Tem certeza que deseja reiniciar o sorteio?')) {
                itensSorteados = [];
                itensDisponiveis = [...itensBingo];
                
                const itemElement = document.getElementById('itemSorteado');
                if (itemElement) {
                    itemElement.textContent = 'Clique em "Sortear Item" para come√ßar!';
                }
                
                carregarItens();
                atualizarEstatisticas();
                salvarEstadoSorteio();
                
                console.log('‚úÖ Sorteio reiniciado com sucesso!');
            } else {
                console.log('‚ùå Rein√≠cio cancelado pelo usu√°rio');
            }
        }

        function salvarEstadoSorteio() {
            try {
                const estado = {
                    itensSorteados: itensSorteados,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('bingoSorteio', JSON.stringify(estado));
                console.log('üíæ Estado do sorteio salvo');
            } catch (error) {
                console.error('‚ùå Erro ao salvar estado:', error);
            }
        }

        function carregarEstadoSorteio() {
            try {
                const estado = localStorage.getItem('bingoSorteio');
                if (estado) {
                    const dados = JSON.parse(estado);
                    itensSorteados = dados.itensSorteados || [];
                    itensDisponiveis = itensBingo.filter(item => !itensSorteados.includes(item));
                    
                    if (itensSorteados.length > 0) {
                        const itemElement = document.getElementById('itemSorteado');
                        if (itemElement) {
                            itemElement.textContent = itensSorteados[itensSorteados.length - 1];
                        }
                    }
                    
                    console.log(`üìä Estado carregado: ${itensSorteados.length} itens sorteados`);
                } else {
                    console.log('üìã Nenhum estado salvo encontrado');
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar estado:', error);
            }
        }

        // ========== SCANNER QR CODE ==========

        async function iniciarScanner() {
            try {
                console.log('üì∑ Iniciando scanner...');
                
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                
                const video = document.getElementById('scanner-video');
                if (video) {
                    video.srcObject = stream;
                    video.style.display = 'block';
                }
                
                const iniciarBtn = document.getElementById('iniciarScanner');
                const pararBtn = document.getElementById('pararScanner');
                
                if (iniciarBtn) iniciarBtn.style.display = 'none';
                if (pararBtn) pararBtn.style.display = 'inline-block';
                
                scanning = true;
                detectarQRCode(video);
                
                console.log('‚úÖ Scanner iniciado com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao iniciar scanner:', error);
                alert('Erro ao acessar a c√¢mera: ' + error.message);
            }
        }

        function pararScanner() {
            console.log('‚èπÔ∏è Parando scanner...');
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            scanning = false;
            if (scannerInterval) {
                clearInterval(scannerInterval);
                scannerInterval = null;
            }
            
            const video = document.getElementById('scanner-video');
            const iniciarBtn = document.getElementById('iniciarScanner');
            const pararBtn = document.getElementById('pararScanner');
            
            if (video) video.style.display = 'none';
            if (iniciarBtn) iniciarBtn.style.display = 'inline-block';
            if (pararBtn) pararBtn.style.display = 'none';
            
            console.log('‚úÖ Scanner parado');
        }

        function detectarQRCode(video) {
            if (!video) {
                console.error('‚ùå Elemento de v√≠deo n√£o encontrado');
                return;
            }
            
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');

            scannerInterval = setInterval(() => {
                if (!scanning || !video || video.videoWidth === 0) return;

                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                
                if (typeof jsQR !== 'undefined') {
                    const qrCode = jsQR(imageData.data, canvas.width, canvas.height);

                    if (qrCode) {
                        console.log('üì± QR Code detectado:', qrCode.data);
                        pararScanner();
                        validarCartela(qrCode.data);
                    }
                } else {
                    console.error('‚ùå Biblioteca jsQR n√£o carregada');
                }
            }, 250); // Reduzido para 250ms para melhor performance
        }

        function validarCartela(dadosQR) {
            try {
                console.log('üîç Validando cartela:', dadosQR);
                
                let cartelaId = dadosQR;
                let dadosCartela = null;
                
                // TENTAR JSON PRIMEIRO (dados completos - funciona entre dispositivos)
                try {
                    dadosCartela = JSON.parse(dadosQR);
                    cartelaId = dadosCartela.id || dadosCartela.hash || `Cartela-${dadosCartela.numero}`;
                    console.log('‚úÖ QR Code com dados completos detectado');
                } catch (parseError) {
                    // SE N√ÉO FOR JSON, TENTAR COMO ID SIMPLES (s√≥ funciona no mesmo dispositivo)
                    if (typeof dadosQR === 'string' && dadosQR.match(/^MARI\d+/)) {
                        console.log('üîç Tentando buscar na base de dados local...');
                        const database = JSON.parse(localStorage.getItem('cartelasDatabase') || '{}');
                        dadosCartela = database[cartelaId];
                        
                        if (!dadosCartela) {
                            throw new Error(`Cartela ${cartelaId} n√£o encontrada na base de dados local. Use o mesmo dispositivo onde as cartelas foram geradas ou gere cartelas com QR codes completos.`);
                        }
                        console.log('‚úÖ Cartela encontrada na base local');
                    } else {
                        throw new Error('QR Code inv√°lido - n√£o cont√©m dados v√°lidos');
                    }
                }

                // Verificar status da cartela
                const itensCartela = dadosCartela.itens;
                const cartelaSorteados = itensCartela.filter(item => itensSorteados.includes(item));
                const cartelaNaoSorteados = itensCartela.filter(item => !itensSorteados.includes(item));
                const isVencedor = cartelaNaoSorteados.length === 0;

                // Mostrar resultado
                const resultadoDiv = document.getElementById('resultadoValidacao');
                const infoDiv = document.getElementById('cartelaInfo');
                
                if (resultadoDiv) {
                    resultadoDiv.style.display = 'block';
                    
                    if (isVencedor) {
                        resultadoDiv.className = 'resultado-validacao vencedor';
                        resultadoDiv.innerHTML = 'üéâ CARTELA VENCEDORA! üéâ<br>BINGO V√ÅLIDO!';
                        
                        if ('vibrate' in navigator) {
                            navigator.vibrate([200, 100, 200]);
                        }
                    } else {
                        resultadoDiv.className = 'resultado-validacao perdedor';
                        resultadoDiv.innerHTML = `‚ùå Cartela incompleta<br>Faltam ${cartelaNaoSorteados.length} item(ns)`;
                    }
                }

                if (infoDiv) {
                    const progresso = Math.round((cartelaSorteados.length / itensCartela.length) * 100);
                    
                    infoDiv.style.display = 'block';
                    infoDiv.innerHTML = `
                        <h4>üìã Cartela ${dadosCartela.numero}</h4>
                        <p><strong>ID:</strong> ${cartelaId}</p>
                        <p><strong>Progresso:</strong> ${progresso}% (${cartelaSorteados.length}/${itensCartela.length})</p>
                        <p><strong>Fonte:</strong> ${dadosCartela.evento || 'N/A'}</p>
                        
                        <h5>‚úÖ Itens sorteados (${cartelaSorteados.length}):</h5>
                        <p>${cartelaSorteados.join(', ') || 'Nenhum'}</p>
                        
                        ${cartelaNaoSorteados.length > 0 ? `
                        <h5>‚è≥ Itens restantes (${cartelaNaoSorteados.length}):</h5>
                        <p>${cartelaNaoSorteados.join(', ')}</p>
                        ` : ''}
                    `;
                }

                console.log(`‚úÖ Valida√ß√£o conclu√≠da: ${isVencedor ? 'VENCEDOR' : 'INCOMPLETA'}`);

            } catch (error) {
                console.error('‚ùå Erro na valida√ß√£o:', error);
                
                const resultadoDiv = document.getElementById('resultadoValidacao');
                const infoDiv = document.getElementById('cartelaInfo');
                
                if (resultadoDiv) {
                    resultadoDiv.style.display = 'block';
                    resultadoDiv.className = 'resultado-validacao perdedor';
                    resultadoDiv.innerHTML = `‚ùå Erro: ${error.message}`;
                }
                
                if (infoDiv) {
                    infoDiv.style.display = 'block';
                    infoDiv.innerHTML = `
                        <h4>‚ö†Ô∏è Erro na Valida√ß√£o</h4>
                        <p>QR Code inv√°lido ou cartela n√£o encontrada</p>
                        <p><strong>Erro:</strong> ${error.message}</p>
                        <p><strong>Dica:</strong> Se as cartelas foram geradas em outro dispositivo, certifique-se de que foram geradas com a vers√£o atualizada que inclui dados completos no QR Code.</p>
                        <details>
                            <summary>Dados recebidos (clique para expandir)</summary>
                            <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 12px; overflow-x: auto;">${dadosQR.substring(0, 300)}...</pre>
                        </details>
                    `;
                }
            }
        }

        // ========== FUN√á√ÉO DE TESTE/DEBUG ==========
        
        function testarValidacao() {
            console.log('üß™ Iniciando teste de valida√ß√£o...');
            
            // Criar uma cartela de teste com dados completos (simulando QR code cross-device)
            const cartelaIdTeste = 'MARI01TEST';
            const itensTeste = itensBingo.slice(0, 24); // Primeiros 24 itens
            
            const cartelaTeste = {
                id: cartelaIdTeste,
                numero: 1,
                itens: itensTeste,
                evento: 'Ch√° de Panela da Mari - TESTE',
                criadaEm: new Date().toISOString()
            };
            
            console.log('‚úÖ Cartela de teste criada:', cartelaTeste);
            
            // Simular QR code com dados completos (como seria entre dispositivos)
            const qrCompleto = JSON.stringify(cartelaTeste);
            console.log('üì± Simulando scan de QR code com dados completos...');
            
            // Testar valida√ß√£o
            validarCartela(qrCompleto);
        }

        function debugDatabase() {
            console.log('üîç DEBUG: Verificando base de dados...');
            
            const database = JSON.parse(localStorage.getItem('cartelasDatabase') || '{}');
            const chaves = Object.keys(database);
            
            console.log('üìä Total de cartelas:', chaves.length);
            console.log('üîë IDs das cartelas:', chaves);
            
            if (chaves.length > 0) {
                console.log('üìã Primeira cartela como exemplo:', database[chaves[0]]);
            }
            
            const resultadoDiv = document.getElementById('resultadoValidacao');
            const infoDiv = document.getElementById('cartelaInfo');
            
            if (resultadoDiv) {
                resultadoDiv.style.display = 'block';
                resultadoDiv.className = 'resultado-validacao';
                resultadoDiv.style.background = '#f0f0f0';
                resultadoDiv.style.color = '#333';
                resultadoDiv.innerHTML = `
                    üìä <strong>DEBUG - Base de Dados</strong><br>
                    Total de cartelas: ${chaves.length}<br>
                    ${chaves.length > 0 ? 'Status: ‚úÖ OK' : 'Status: ‚ùå Vazia'}
                `;
            }
            
            if (infoDiv && chaves.length > 0) {
                infoDiv.style.display = 'block';
                infoDiv.innerHTML = `
                    <h4>üîç An√°lise da Base de Dados</h4>
                    <p><strong>Total:</strong> ${chaves.length} cartelas</p>
                    <p><strong>IDs:</strong> ${chaves.slice(0, 5).join(', ')}${chaves.length > 5 ? '...' : ''}</p>
                    <p><strong>Exemplo de estrutura:</strong></p>
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 12px; overflow-x: auto;">${JSON.stringify(database[chaves[0]], null, 2)}</pre>
                `;
            }
        }

        // Debug para verificar se o script carregou
        console.log('‚úÖ Script carregado completamente!');
    </script>
</body>
</html>
